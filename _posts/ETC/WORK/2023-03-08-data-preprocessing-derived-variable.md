*---
layout: post
title:  "제조 데이터 분석에서 파생변수 생성이란?"
subtitle:   "manufacturing_data"
categories: etc
tags: etc_work
comments: true
---*

https://yeong-jin-data-blog.tistory.com/m

* 이번 글은 제조 데이터 분석을 하면서 필요한 데이터 전처리 중 파생변수 생성 부분에 대해 정리해보았습니다. 
* 데이터 및 공정 등 어떤 분석을 하냐에 따라서 생성되는 파생변수들이 조금씩 달라지다보니, 일반적인 것들 위주로 작성하려고 하였습니다.😅
* 파생변수 생성 케이스 관련해서 예시 및 코드를 계속 추가할 예정입니다! 꾸준히..추가해보도록 할게요..!🔥

----

데이터 분석 프로세스 중 **데이터 전처리(Data Preprocessing)** 단계는 **분석을 수행할 때 다양한 원천 데이터 소스를 통해 목적에 맞는 데이터 형태를 만들기 위한 단계**입니다. <br>

데이터 분석에서 데이터 전처리는 매우 중요한 단계라고 할 수 있으며, 분석 결과의 정확도와 신뢰도에 큰 영향을 미칩니다.
1. 데이터 품질 향상
 * 결측치, 이상치, 중복 데이터 등이 분석 결과에 영향을 미치기 때문에, 이를 처리하고 데이터를 정제하는 과정이 필요
2. 모델 성능 향상
 * 데이터의 스케일이 서로 다른 경우 분석 결과가 왜곡될 수 있기 때문에, 이를 처리하면 성능 개선 및 정확한 예측을 기대할 수 있음
3.일관성 있는 데이터 구성
 * 데이터 전처리를 통해, 데이터 구성에 일관성이 생김

개인적인 생각이지만, 분석을 하면 할수록 데이터 전처리 단계야말로 분석가의 노하우가 매우 중요시 되는 부분이라고 느끼고 있습니다. 그 이유는 데이터 가공을 어떻게 진행했냐에 따라, 의미 있는 분석 결과를 얻거나 성능 좋은 모델을 만들 때 효과를 볼 수 있는 부분이기 때문입니다. <br>
아무래도 주로 접할 수 있는 Kaggle이나 Dacon의 예제 데이터들은 이미 데이터가 정제된 상태인 경우가 많습니다. 그렇기 때문에 실제 업무를 진행할 때에는 예제 데이터와 같이 데이터를 정제하고 분석하기 위한 형태로 만드는데 시간을 투자하는 것이 중요합니다. 저도 분석을 진행할 때 데이터 가공 단계에서 많은 시간을 투자하고 있으며, 어떻게 가공을 해서 데이터 특성을 더욱 잘 살릴 수 있을지 고민을 하고 있습니다. 모델을 재구성하거나 분석 가설을 다시 세워서 재진행할 때에도, 데이터 가공 단계부터 다시 시작하는 경우도 있구요!

<br>

## 🎈 Data Preprocessing 종류
데이터 가공 단계는 아래의 예시 그림과 같이 정말 다양한 범위를 포함하고 있습니다.
![image](https://user-images.githubusercontent.com/54492747/221466863-760c9898-e377-4716-8338-5a7ac2750183.png)
[DATA PREPROCESSING | DATA CLEANING PYTHON](https://ai-ml-analytics.com/data-preprocessing-data-cleaning-python/)

대표적인 Data Preprocessing 방법들은 다음과 같습니다.
1. 결측치(Missing Value) 처리
 * 결측치 : 데이터에서 값이 없는 케이스
 * 대표적인 방법 : 평균, 중앙값, 최빈값으로 채우기 / 해당 데이터를 제외

2. 이상치(Outlier) 처리
 * 이상치 : 정상적인 값의 범위에서 크게 벗어난 값
 * 대표적인 방법 : 이상치를 제거 / 다른 값으로 대체 / Isolation Forest / OneLCassSVM
 * 하지만 도메인에 따라서 이상치 기준이 다르기 때문에, 도메인 및 데이터에 따라 이상치 처리 기준을 정해야함
  * 일부 도메인에서는 이상치를 더 중요시 여기는 경우도 있음

3. 데이터 변환
 * 데이터 분석에 사용되는 데이터는 종종 비선형성을 가지거나, 분포가 치우친 경우가 존재함
 * 대표적인 방법 : 로그 변환 / 제곱근 변환

4. 데이터 스케일링(Feature Scaling)
 * 데이터의 스케일이 서로 다른 경우, 분석 결과가 왜곡될 수 있음
 * 대표적인 방법 : 표준화(Standardization) / 정규화 / Min-Max Nomarlization

5. 데이터 인코딩
 * 분석에 사용되는 대부분의 모델은 문자열을 처리할 수 없기 때문에, 문자열을 수치형 값으로 변환하는 과정이 필요함
 * 대표적인 방법 : 원-핫 인코딩 /  레이블 인코딩

6. 피쳐 엔지니어링 (Feature Engineering)
 * Raw Data로부터 Feature를 만들거나 재구성하는 과정
 * 대표적인 방법 : Feature Extraction / Encoding / 통합, 정제, 변환, 파생변수
  *  eature Extraction : 주어진 Featrue 바탕으로 새로운 Feature로 재구성

이번 글에서는 데이터 전처리 중 파생변수(Derived Variable)를 생성하는 것에 대해 설명하도록 하겠습니다.

<br>

## 🎈 파생변수 목적 및 의의
파생변수(Derived Variable)는 **기존의 변수를 조합하여 새로운 변수를 만들어 내는 것**을 의미합니다. 도메인 전문가의 아이디어가 중요하며, 주의 깊게 생각하는 부분의 가정(가설)을 설정하여 파생변수를 생성하는 과정을 거치게 됩니다.
* 예시) 화학산업 - 촉매 반응시간 파생변수


파생변수를 만드는 것이 데이터 전처리의 최종 목적이 아닌, **분석 목적에 맞게 적절한 파생변수를 생성**하는 것이 중요합니다. 적절한 파생변수를 생성함으로써 기존 변수에서 파악하기 힘든 패턴이나 관계를 발견할 수 있으며, 이를 통해 모델의 성능을 향상시키는 것은 데이터 분석에서 매우 중요한 단계 중 하나입니다. <br>
이때 주의해야할 점은 다음과 같습니다.
1. 데이터 분석 및 예측에 활용하기 위해, 특정 상황(or 기간)에만 의미가 있는 것보다 전 데이터구간에 대표성을 가질 수 있는 파생변수를 생성해야함
2. 특정 함수에 의해 값을 만들어 의미를 부여하기 때문에, 해석할 수 있는 논리적 타당성이 필요함

<br>

### ✅ 파생변수 생성 방법
파생변수는 생성하는 방법들은 다양하게 있지만, 일반적으로 다음과 같은 방법들이 있습니다.
1. 새로운 변수의 조합
 * 두 개 이상의 변수를 조합(ex. 곱셉, 나눗셈, 덧셈, 뺄샘 등의 연산)하여 새로운 변수를 생성함
 * 예시) 주택가격 예측 모델 - 주택의 면적과 방의 개수를 곱하여 새로운 변수를 생성 / BMI(체질량 지수) - 신장과 체중의 곱셈

2. 구간 분할(Binning)
 * 연속형 변수의 값을 특정 구간으로 나누어 이산형 변수로 변환하거나 분위수/퍼센트 등급 등으로 변환하여 새로운 변수를 생성함
 * 예시) 키, 변수를 분위수 등급으로 변환하여 새로운 변수를 생성 / 연령 - 10대, 20대, 30대 등

3. 이동평균(Moving Average) & 이동분산(Moving Variance)
 * 변수의 이동평균 또는 이동분산을 계산하여 새로운 변수를 생성함
 * 예시) 시계열 데이터 - 최근 3일간의 평균을 계산하여 새로운 변수를 생성

4. 로그/제곱근 등의 변환
 * 변수의 값을 로그/제곱근 등으로 변환하여 새로운 변수를 생성함
 * 예시) 매출액 변수를 로그 변환하여 새로운 변수를 생성

5. 클러스터링
 * 변수를 클러스터링하여 새로운 변수를 생성함
 * 예시) 고객 데이터 - 유사한 고객을 클러스터링하여 새로운 변수를 생성

6. 외부 데이터
 * 외부 데이터를 가져와 기존 데이터와 결합하여 새로운 변수를 생성함
 * 예시) 날씨 데이터를 가져와 주식 가격 예측 모델에 적용하여 새로운 변수를 생성

7. 조건문 활용
 * 조건에 따라 서로 다른 값을 반환하는 조건문 함수를 이용하여 새로운 변수를 생성함
 * 예시) 연비가 20이 넘는 자동차에 고연비 합격 판정을 내리고, 넘지 못하면 불합격으로 분류된 새로운 변수를 생성


### ✅ 제조분석 - 파생변수 생성 방법
그렇다면 제조 분석에서의 파생변수 생성은 어떤 케이스가 있을까요? <br>
위에서 얘기한 파생변수 생성 방법과 비슷하지만, 제조 용어들을 사용해서 설명하도록 하겠습니다.

1. 반응속도 변수 (Reaction Rate Variables)
 * 반응 시간과 반응 조건에 대한 변수를 조합하여 생성
 * 예시) 반응 시간, 온도, 압력, 농도 등의 변수를 조합하여, 반응 속도를 나타내는 변수를 생성

2. 불량률 변수 (Defect Rate Variables)
 * 불량률 : 제조 공정에서 발생하는 불량 제품의 비율을 나타내는 지표
 * 제조과정에서 발생하는 불량의 원인에 대한 변수를 조합하여 생성
 * 예시) 공정 온도, 압력, 속도 등의 변수를 조합하여, 불량률을 예측하는 변수를 생성
공정 운전 데이터를 이용하여 해당 공정에서 불량률이 높은 시간대나 작업조를 구분할 수 있습 -> 불량률을 예측하는 변수를 생성할 수 있습니다.

3. 공정능력 지수 변수 (Process Capability Index Variables)
 * 공정능력 지수 : 제조 공정의 안정성과 정확성을 나타내는 지표
 * 제조 공정에서 측정된 데이터를 이용하여, 공정능력 지수를 계산할 수 있음
 * 예시) 생산 라인의 평균값과 표준편차를 이용하여, 공정능력 지수 변수를 생성

4. 시간 관련 변수 (Time Variables)
 * 제조분야에서는 시간에 따라 생산 라인의 성능이 달라질 수 있음
 * 예시) 생산 라인의 가동시간, 정지시간, 교체시간 등의 변수를 생성



생산량 변수 (Production Quantity Variables)
생산량은 제조 공정에서 생산되는 제품의 양을 나타내는 지표입니다. 파생변수로는, 공정 운전 데이터를 이용하여 해당 공정에서 생산량이 높은 시간대나 작업조를 구분할 수 있습니다. 이를 토대로, 생산량을 예측하는 변수를 생성할 수 있습니다.

에너지 소비 변수 (Energy Consumption Variables)
에너지 소비는 제조 공정에서 소비되는 전기, 가스, 수도 등의 에너지 양을 나타내는 지표입니다. 파생변수로는, 공정 운전 데이터를 이용하여 해당 공정에서 에너지 소비가 높은 시간대나 작업조를 구분할 수 있습니다. 이를 토대로, 에너지 소비를 예측하는 변수를 생성할 수 있습니다.

가동률 변수 (Operating Rate Variables)
가동률은 제조 공정에서 생산 설비가 가동되는 시간의 비율을 나타내는 지표입니다. 파생변수로는, 공정 운전 데이터를 이용하여 해당 공정에서 가동률이 높은 시간대나 작업조를 구분할 수 있습니다. 이를 토대로, 가동률을 예측하는 변수를 생성할 수 있습니다.

소요시간 변수 (Lead Time Variables)
소요시간은 제조 공정에서 생산된 제품이 고객에게 전달되기까지 걸리는 시간을 나타내는 지표입니다. 파생변수로는, 공정 운전 데이터를 이용하여 해당 공정에서 소요시간이 긴 작업조나 시간대를 구분할 수 있습니다. 이를 토대로, 소요시간을 예측하는 변수를 생성할 수 있습니다.


• 모델 구축 과정에서 유의한 파생변수를 만드는 것은 굉장히 중요하다. 그런데 여러 프로젝트나 공모전에서 예측/분류 모델을 만들다 보면 나름의 분석 결과와 도메인 지식으로 도출한 인사이트를 기반으로 파생변수를 만들었는데, 모델 성능에 도움이 되지 않는 경우가 있어서 난감했던 적이 많았다. 이런 경우에는 어떻게 하지? 
→ 파생변수 생성 과정에서 내가 생각한 근거가 잘못됐을 가능성이 있다. 항상 내 머리를 의심하자. 
→ 모델 성능이 당장 좋지 않더라도 해당 파생 변수를 포함시키는게 좋을 수도 있다. 추후 데이터나 모델 구조가 바뀌었을 때, 그 변수가 유용하게 사용될 수 있기 때문이다. 

• 그럴듯한 가설과 근거를 기반으로 회귀분석을 했을 때, 예상과 다른 결과가 나온다면 오히려 흥미로운 분석이 가능한 기회일 수도 있다. 
ex) 잠재 그룹을 찾는 추가 분석을 실시할 수 있음. 예를 들어,  LDA로 잠재 그룹을 나누고 Latent class regression을 실시해보면, 집단별로 다른 유의미한 결과를 찾을 수도 있다. 




 <br>
 


* 부족한 점이나 궁금한 점 있으시면 언제든 피드백 부탁드립니다.🙌

<br>
