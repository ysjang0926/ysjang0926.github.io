---
layout: post
title: "ìºê¸€ Emergency - 911 Calls : Exploratory Data Analysis"
subtitle: "kaggle 911 Calls - EDA"
categories: data
tags: kaggle
comments: true
toc: true
toc_sticky: true
---

* Kaggleì˜ [Emergency - 911 Calls](https://www.kaggle.com/mchirico/montcoalert) ë°ì´í„°ë¥¼ ì´ìš©í•œ íƒìƒ‰ì  ë°ì´í„° ë¶„ì„(Exploratory Data Analysis, EDA)ì„ ì§„í–‰í•˜ì˜€ìŠµë‹ˆë‹¤.
* í•´ë‹¹ í¬ìŠ¤íŒ…ì—ì„œ ì‚¬ìš©í•œ ì „ì²´ ì½”ë“œì™€ ê·¸ë˜í”„ëŠ” í•´ë‹¹ [Kernel](https://www.kaggle.com/ysjang0926/eda-911-calls-kor)ì—ì„œë„ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.ğŸ¤—
    * plotlyì™€ github ê°„ì˜ ì—°ë™ì— ì‹¤íŒ¨í•´ì„œ(ã… ã… ..), plotlyë§Œì˜ interactive ê·¸ë˜í”„ë¥¼ í´ë¦­í•˜ë©´ì„œ ë³´ê³  ì‹¶ìœ¼ì‹œë©´ ìœ„ì˜ ì»¤ë„ë¡œ ë³´ì‹œëŠ”ê±¸ ì¶”ì²œë“œë¦½ë‹ˆë‹¤.

---

# 1. Introduction

![emergency](https://user-images.githubusercontent.com/54492747/79099267-bac50400-7d9e-11ea-8049-f7ad1cbe30aa.jpg)

Kaggleì— ìˆëŠ” **Montgomery Countyì˜ 911 í†µí™”**ì—ì„œ ìˆ˜ì§‘ëœ ë°ì´í„°ì— ëŒ€í•œ EDA(Exploratory Data Analysis) ê³¼ì •ì„ ì§„í–‰í•˜ì˜€ìŠµë‹ˆë‹¤.

êµ¬ì¡°ëŒ€ì›ë“¤ì€ ê·¸ë“¤ì´ ì¼í•˜ëŠ” ë™ì•ˆ í•­ìƒ ë§ì€ ì‚¬ëŒë“¤ì˜ ìƒëª…ì„ êµ¬ì¡°í•©ë‹ˆë‹¤. í•œ ë²ˆì˜ ì‘ì€ ì‹¤ìˆ˜ê°€ ì£½ìŒì„ ì´ˆë˜í•  ìˆ˜ ìˆê¸°ì—, ê·¸ë“¤ì˜ ì‘ì—…ì€ ì˜¤ëœ ì‹œê°„ ë™ì•ˆ ì—„ì²­ë‚œ ì§‘ì¤‘ë ¥ì„ í•„ìš”ë¡œ í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ ì•ìœ¼ë¡œ ì–´ë–¤ ì¢…ë¥˜ì˜ ì‚¬ê³ ê°€ ì¼ì–´ë‚ ì§€ ì•Œ ìˆ˜ ì—†ê¸° ë•Œë¬¸ì— ì¼ì • ìˆ˜ì˜ êµ¬ì¡°ëŒ€ì›ì´ í•­ìƒ í•„ìš”í•©ë‹ˆë‹¤. í–¥í›„ ì¼ë°˜ì ì¸ ì‚¬ê³  ë°œìƒ ê±´ìˆ˜ë¥¼ ì˜ˆì¸¡í•  ìˆ˜ ìˆë‹¤ë©´ ì ì ˆí•œ ì‹œê¸°ì— ì ì ˆí•œ êµ¬ì¡° ì¸ë ¥ì„ ë°°ì¹˜í•˜ëŠ” ê²ƒì´ ë” ì‰¬ìš¸ ê²ƒì´ë¼ ìƒê°í•©ë‹ˆë‹¤. ì´ëŠ” ë˜í•œ êµ¬ì¡°ëŒ€ì›ë“¤ì˜ ì ì ˆí•œ íœ´ì‹ ì‹œê°„ìœ¼ë¡œë„ ì´ì–´ì§ˆ ìˆ˜ ìˆì„ ê²ƒì´ë¼ ê¸°ëŒ€í•©ë‹ˆë‹¤.

`911.csv` ë°ì´í„°ì˜ ì¶œì²˜ëŠ” [http://montcoalert.org/](http://montcoalert.org/)ì…ë‹ˆë‹¤. ì´ í™ˆí˜ì´ì§€ëŠ” Montgomery Countyì˜ 911 í†µí™”ì— ëŒ€í•œ ì •ë³´ë¥¼ ì œê³µí•©ë‹ˆë‹¤. Montgomery CountyëŠ” íœì‹¤ë² ë‹ˆì•„ ì—°ë°©ì— ìœ„ì¹˜í•˜ê³  ìˆìŠµë‹ˆë‹¤.<br>
ë°ì´í„°ëŠ” 2015ë…„ 12ì›” 10ì¼ë¶€í„° 2020ë…„ 4ì›” 8ì¼ê¹Œì§€ ìˆ˜ì§‘ë˜ì–´ ìˆìŠµë‹ˆë‹¤. (ì£¼ê¸°ì ìœ¼ë¡œ ë°ì´í„°ê°€ ì—…ë°ì´íŠ¸ ë˜ê³  ìˆëŠ” ê²ƒ ê°™ìŠµë‹ˆë‹¤.)

<br>

- í•´ë‹¹ ê¸€ì˜ êµ¬ì„±ì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.
    + **ì§€ë„**ë¥¼ í†µí•´ ì‚¬ê³  ë¶„í¬ì— ëŒ€í•œ ê°„ëµí•œ ì„¤ëª…
    + Montgomery Countyì—ì„œì˜ **911 í†µí™”**
        + 911 í†µí™” ìœ í˜•ì˜ **ë°±ë¶„ìœ¨**
        + **ì‹œê°„ì˜ ê²½ê³¼ì— ë”°ë¥¸** 911 í†µí™” ìˆ˜ ì¶”ì´
        + 911 í†µí™” ìœ í˜• ê°„ì˜ **ìƒê´€ ê´€ê³„**
        + ì›”, ì¼, ì‹œê°„ë³„ **911 í†µí™” íŠ¸ë Œë“œ**
        + **íˆíŠ¸ë§µ**ì— ë”°ë¥¸ ê²°ê³¼
    + **ê±°ì£¼ì§€(township)**ì— ë”°ë¥¸  Montgomery Countyì—ì„œì˜ 911 í†µí™”
        + 911 í†µí™” ìœ í˜•ë³„ **ëª¨ìì´í¬ í”Œë¡¯**
        + 911 í†µí™”ì˜ í•˜ìœ„ ìœ í˜•ë³„ **ëª¨ìì´í¬ í”Œë¡¯**
        + **ê° ê±°ì£¼ì§€ì— ëŒ€í•œ íˆíŠ¸ë§µ**ì— ë”°ë¥¸ ê²°ê³¼
    + í–¥í›„ ì‚¬ê³  ë°œìƒ íšŸìˆ˜ **ì˜ˆì¸¡**

<br>

## 1.2 Loading packages and Attributes of data
`ggplot2`, `dplyr`ì™€ ê°™ì€ Rì˜ ëŒ€í‘œì ì¸ Packageë¥¼ í¬í•¨í•˜ì—¬ EDAë¥¼ í•˜ëŠ”ë° ì‚¬ìš©í•œ ëª¨ë“  Packageë“¤ì„ ë¶ˆëŸ¬ì˜¤ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤. Package ì˜†ì— ê°„ë‹¨í•œ ì£¼ì„ì„ ë‹¬ì•„ë†¨ìŠµë‹ˆë‹¤.

```{r}
# Load packages
library(dplyr) # Data manipulation
library(tidyr) # Data manipulation
library(xts) # Creating xts's object
library(lubridate) #Helps dealing with dates a little easier
library(qtlcharts) # Making plot of correlation table
library(forecast) # Time series Forecast
library(tseries) # Time series analysis
library(leaflet) # Visualization
library(ggplot2) # Visualization
library(plotly) # Visualization
library(dygraphs) # Visualization
library(viridis) # Colormap
library(graphics) # Mosaic plot
```

í•„ìš”í•œ ëª¨ë“  Packageë¥¼ ë¶ˆëŸ¬ì™”ìœ¼ë©°, ë°ì´í„° ì†ì„±ì„ í™•ì¸í•´ë³´ê² ìŠµë‹ˆë‹¤.

```{r}
# Check data
call <- read.csv("../input/montcoalert/911.csv")
knitr::kable(head(call,n=3))
str(call) # 626350 obs. of  9 variables
``` 
![ìºê¸€_ì†ì„±](https://user-images.githubusercontent.com/54492747/79865814-be97fc80-8416-11ea-861b-63fc07e85b43.JPG)

![ìºê¸€_str](https://user-images.githubusercontent.com/54492747/79865924-f4d57c00-8416-11ea-8fb0-c741c1b9b6bc.JPG)

ë³€ìˆ˜ëª…ê³¼ í´ë˜ìŠ¤ ìœ í˜•ì€ ìœ„ì™€ ê°™ìœ¼ë©°, ì´ 626,350ê°œì˜ ê´€ì¸¡ì¹˜ì™€ 9ê°œì˜ ë³€ìˆ˜ê°€ ìˆìŠµë‹ˆë‹¤. ë³€ìˆ˜ì— ëŒ€í•œ ê°„ë‹¨í•œ ì„¤ëª…ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

ë³€ìˆ˜ëª…        | ì„¤ëª…
--------------|----------------------------------------------------
lat           | ìœ„ë„(Latitude)
lng           | ê²½ë„(Longitude)
desc          | ì‘ê¸‰ í†µí™”ì— ëŒ€í•œ ì„¤ëª…(EMS: ì‘ê¸‰ì˜ë£Œ ì„œë¹„ìŠ¤, Fire: í™”ì¬, Traffic: êµí†µì‚¬ê³ )
zip           | ìš°í¸ë²ˆí˜¸(Zipcode)
title         | í†µí™” ì œëª¨
timeStamp     | YYYY-MM-DD HH:MM:SS
twp           | êµ°êµ¬(Township, county ì•„ë˜ì˜ í–‰ì • êµ¬ì—­ ë‹¨ìœ„)
addr          | ì£¼ì†Œ
e             | ë”ë¯¸ë³€ìˆ˜(always 1)

<br>

## 1.3 Handling Data

ê¸°ì¡´ ë³€ìˆ˜ì—ì„œ ìƒˆë¡œìš´ ëª‡ ê°œì˜ ë³€ìˆ˜ë¥¼ ë§Œë“¤ê¸° ìœ„í•´ í•„ìš”í•˜ì§€ ì•Šì€ ë³€ìˆ˜ ì œê±° ë“±ì˜ ì „ì²˜ë¦¬ ì‘ì—…ì„ ê±°ì³¤ìŠµë‹ˆë‹¤.

```{r}
calls <- separate(call,title,c("Types","Subtypes"),sep=":")
# Separate Title into Types and Subtypes.

calls$timeStamp <- as.POSIXlt(call$timeStamp)
calls$Date <- as.Date(calls$timeStamp)
calls$Year<-factor(year(calls$Date))
calls$Month<-factor(month(calls$Date))
calls$Day<-factor(day(calls$Date))
calls$Hour <- factor(calls$timeStamp$hour)
calls$zip<-factor(calls$zip)
calls$Subtypes<-factor(calls$Subtypes)
calls$Types<-factor(calls$Types)
# Handling timestamp variable and change the classes of some variables into factor.

calls<-calls[,-10]
# Erase unnecessary dummy variable, e, as it is always 1.

knitr::kable(head(calls,n=3))

str(calls) # 123884 obs. of  14 variables
```

![ìºê¸€_ìƒˆì†ì„±](https://user-images.githubusercontent.com/54492747/79866182-54cc2280-8417-11ea-82b9-583d5e369b14.JPG)

![ìºê¸€_ìƒˆstr](https://user-images.githubusercontent.com/54492747/79866195-572e7c80-8417-11ea-94d7-18d143f12795.JPG)

<br>

-----

# 2.Exploratory Data Analysis

## 2.1 Brief Explanation on "Accident Distribution"

```{r}
call_map <- leaflet() %>% addTiles() %>% setView(lng=-75.2, lat=40.1, zoom=10) %>% addMarkers(data=calls, lng= ~lng, lat= ~lat, clusterOptions = markerClusterOptions())
call_map
```
![ìºê¸€_ì§€ë„](https://user-images.githubusercontent.com/54492747/79866299-8513c100-8417-11ea-8f66-78553f81f3aa.JPG)

- ìœ„ì—ì„œ ì„¤ëª…í•œ ê²ƒê³¼ ê°™ì´, ë°ì´í„°ëŠ” **Montgomery County**ì— ìœ„ì¹˜í•œ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- 911 í†µí™”ì˜ ëŒ€ë¶€ë¶„ì€ **Norristown(185,052)**, ê·¸ ë‹¤ìŒìœ¼ë¡œ **Abington(92,658)**, **Lansdale(88,947)**ì…ë‹ˆë‹¤.

<br>

## 2.2 911 Calls in Montgomery County, Generally

### ğŸš‘ Percentage of Types of 911 Calls
ì‚¬ê³ ì˜ ì¢…ë¥˜ì— ë”°ë¼ ê·¸ì— ë§ëŠ” ì „ë¬¸ê°€ê°€ í•„ìš”í•©ë‹ˆë‹¤. íŒŒì´ ì°¨íŠ¸ë¥¼ í†µí•´ ì„¸ ê°€ì§€ ìœ í˜•ì˜ í†µí™” ë¹„ìœ¨ì„ í™•ì¸í–ˆìŠµë‹ˆë‹¤.

```{r}
freqt.calls <-as.data.frame(table(calls$Type))
freqt.calls

plot_ly(freqt.calls,labels=~Var1,values=~Freq,type='pie',
        textposition='inside',
        textinfo='label+percent',
        insidetextfont=list(color='#FFFFFF',size=20),
        hoverinfo='text',
        marker=list(colors=c('rgb(0,204,102)','rgb(211,94,96)','rgb(51,153,255)'),
                    line=list(color='#FFFFFF',width=1)),
                    showlegend = FALSE)%>%
  layout(title="Frequency of Three Types of 911 calls",
         xaxis=list(showgrid=F,zeroline=F,showticklabels=F),
         yaxis=list(showgrid=F,zeroline=F,showticklabels=F))
```

![ìºê¸€_ë¹ˆë„ìˆ˜](https://user-images.githubusercontent.com/54492747/79866509-dae86900-8417-11ea-8584-98c886a7d9a0.JPG)

![ìºê¸€_íŒŒì´ì°¨íŠ¸](https://user-images.githubusercontent.com/54492747/79866514-dcb22c80-8417-11ea-842b-87cb01610c5c.JPG)

- **EMS**ê°€ **49.2%**ë¥¼ ì°¨ì§€í–ˆìœ¼ë©°, ë‹¤ìŒìœ¼ë¡œ **Traffic(35.2%)**, **Fire(15%)**ì…ë‹ˆë‹¤.
- EMSê°€ ê°€ì¥ ë§ì•˜ìœ¼ë©°, ì•„ë§ˆë„ ì‚¬ê³  ìœ í˜•ì— ìƒê´€ì—†ì´ ì‚¬ëŒë“¤ì´ ëŒ€ë¶€ë¶„ì˜ ì‚¬ê³ ì—ì„œ ë‹¤ì¹˜ê¸° ë•Œë¬¸ì¼ ê²ƒì´ë¼ ìƒê°í•©ë‹ˆë‹¤.

<br>

### ğŸš‘ How the number of 911 Calls varies as the time goes by (for each types)
EMS í†µí™”ëŸ‰ì´ íŠ¹ì • ê¸°ê°„ ë‚´ì—ë„ ë‹¤ë¥¸ ë³€ìˆ˜ë³´ë‹¤ ë§ì„ì§€ ê¶ê¸ˆí•˜ì—¬, ì‹œê³„ì—´ ê·¸ë˜í”„ë¥¼ ì‚¬ìš©í•˜ì—¬ ë³´ì•˜ìŠµë‹ˆë‹¤.

```{r}
fre.calls.ems <-as.data.frame(table(calls[calls$Types=="EMS",]$Date))
fre.calls.fire <-as.data.frame(table(calls[calls$Types=="Fire",]$Date))
fre.calls.traffic <-as.data.frame(table(calls[calls$Types=="Traffic",]$Date)) 
fre.calls.ems$Var1 <- as.Date(fre.calls.ems$Var1)
fre.calls.fire$Var1 <- as.Date(fre.calls.fire$Var1)
fre.calls.traffic$Var1 <- as.Date(fre.calls.traffic$Var1) 
# Convert between character representations and objects of class "Date"

ems.ts <- xts(fre.calls.ems$Freq, fre.calls.ems$Var1)
fire.ts <- xts(fre.calls.fire$Freq, fre.calls.fire$Var1)
traffic.ts <- xts(fre.calls.traffic$Freq, fre.calls.traffic$Var1) 
# Creating an extensible time-series object

names(ems.ts) <- "EMS"
names(fire.ts) <- "FIRE"
names(traffic.ts) <- "TRAFFIC" # Specify a column name 

ts.types <- cbind(ems.ts, fire.ts, traffic.ts)

dygraph(ts.types, main="Three Types of 911 calls") %>% 
dyRangeSelector() %>% # Choosing a range becomes available
dyOptions(colors=c('rgb(0,204,102)','rgb(211,94,96)','rgb(51,153,255)')) # Allocates each line's  colors
```

![ìºê¸€_ì‹œê³„ì—´ê·¸ë˜í”„](https://user-images.githubusercontent.com/54492747/79866678-1daa4100-8418-11ea-8de5-af40401082de.JPG)

- ì „ë°˜ì ìœ¼ë¡œ EMS í†µí™”ëŸ‰ì´ ë‹¤ë¥¸ í†µí™”ëŸ‰ë³´ë‹¤ ë§ìŠµë‹ˆë‹¤. 
- Trafficì— ëŒ€í•œ í†µí™” ìˆ˜ê°€ EMSì— ëŒ€í•œ í†µí™” ìˆ˜ë¥¼ ì´ˆê³¼í•œ ê²½ìš°ëŠ” ê±°ì˜ ì—†ìŠµë‹ˆë‹¤.
- íŠ¹íˆ **2018ë…„ 3ì›” 2ì¼**ê³¼ **2018ë…„ 11ì›” 15ì¼**ì˜ Traffic í†µí™” ìˆ˜ê°€ í˜„ì €íˆ ë†’ì•˜ìŠµë‹ˆë‹¤.
- ì„¸ ê°€ì§€ ìœ í˜•ì˜ 911 í†µí™” ìˆ˜ëŠ” ì„œë¡œ ìƒê´€ê´€ê³„ê°€ ìˆëŠ” ê²ƒìœ¼ë¡œ ë³´ì…ë‹ˆë‹¤.
- ê·¸ë˜í”„ëŠ” ì£¼ê¸°ì ì¸ trendëŠ” ë³´ì´ì§€ ì•ŠëŠ” ê²ƒ ê°™ìŠµë‹ˆë‹¤.

<br>

### ğŸš‘ Correlation among Types of 911 Calls
ì„¸ ê°€ì§€ ìœ í˜•ì˜ ìƒê´€ê´€ê³„ë¥¼ í™•ì¸í•˜ê¸° ìœ„í•´ ìƒê´€ê´€ê³„ í–‰ë ¬ì„ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤. <br>
(í•´ë‹¹ [Kernel](https://www.kaggle.com/ysjang0926/eda-911-calls-kor)ë¡œ ë“¤ì–´ê°€ì‹œë©´, ì‚¬ê°í˜• ìƒìì— **ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë ¤** ë†“ìœ¼ë©´ **ìƒê´€ê³„ìˆ˜**ë¥¼ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆê³  ì‚¬ê°í˜• ìƒìë¥¼ **í´ë¦­**í•˜ë©´ ì´ì— ë”°ë¥¸ **ì‚°ì ë„** ë˜í•œ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.)

```{r}
month <- as.data.frame(calls %>% select(-timeStamp) %>% group_by(Month, Types) %>% summarise(N=n()) %>% spread(Types, N))

day <- as.data.frame(calls %>% select(-timeStamp) %>% group_by(Day, Types) %>% summarise(N=n()) %>% spread(Types, N))

hour <- as.data.frame(calls %>% select(-timeStamp) %>% group_by(Hour, Types) %>% summarise(N=n()) %>% spread(Types, N))


iplotCorr(month[,2:4], reorder=TRUE, chartOpts=list(cortitle="Month", scattitle="Scatterplot"))
iplotCorr(day[,2:4], reorder=TRUE, chartOpts=list(cortitle="Day", scattitle="Scatterplot"))
iplotCorr(hour[,2:4], reorder=TRUE, chartOpts=list(cortitle="Hour", scattitle="Scatterplot"))
```

![ìºê¸€_ìƒê´€ê´€ê³„_ì›”](https://user-images.githubusercontent.com/54492747/79867101-c22c8300-8418-11ea-8baf-5524fab1d2a9.JPG)
![ìºê¸€_ìƒê´€ê´€ê³„_ì£¼](https://user-images.githubusercontent.com/54492747/79867113-c5c00a00-8418-11ea-9971-e827d9103611.JPG)
![ìºê¸€_ìƒê´€ê´€ê³„_ì‹œê°„](https://user-images.githubusercontent.com/54492747/79867116-c789cd80-8418-11ea-8f2d-96a6147be08b.JPG)

- 911 í†µí™”ì˜ ëª¨ë“  ìœ í˜•ì€ ì›”, ì¼, ì‹œê°„ì— ê´€ê³„ì—†ì´ ìƒë‹¹íˆ í° ìƒê´€ ê³„ìˆ˜ë¥¼ ë³´ì˜€ìŠµë‹ˆë‹¤.
- ì´ë¥¼ í†µí•´ ëª¨ë“  ìœ í˜•ì˜ ì‚¬ê³ ë“¤ì€ **ìƒí˜¸ì ìœ¼ë¡œ ì—°ê´€**ë˜ì–´ ìˆë‹¤ê³  ê°€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<br>

### â” What happened in 2016-01-23?
2018ë…„ 3ì›” 2ì¼ì— í° Traffic ì‚¬ê³ ê°€ ë°œìƒí–ˆì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤. 1ì¼ê³¼ 2ì¼ì— ë°œìƒí•œ ì‚¬ê³  ê±´ìˆ˜ë¥¼ ì‹œê°„ëŒ€ë³„ë¡œ ë¹„êµí•´ë´¤ìŠµë‹ˆë‹¤. <br>
2ì¼ì— ì¤‘ëŒ€í•œ Traffic ì‚¬ê³ ê°€ ë°œìƒí–ˆë‹¤ë©´, íŠ¹ì • ì‹œê°„ì— êµí†µì‚¬ê³  911 í†µí™” ê±´ìˆ˜ê°€ ìƒë‹¹íˆ ë§ì„ ê²ƒìœ¼ë¡œ ìƒê°í•©ë‹ˆë‹¤.

```{r}
nr<-c()
nn<-c()
for (i in 0:23){
nr[i+1]<-nrow(calls[calls$Date=="2018-03-02" & calls$Types=="Traffic"&calls$Hour==i,])
nn[i+1]<-nrow(calls[calls$Date=="2018-03-01" & calls$Types=="Traffic"&calls$Hour==i,])
}
nrn<-0:23
dnr<-data.frame(time=nrn,value=nr)
dnn<-data.frame(time=nrn,value=nn)
dnr$name<-"2018-03-02"
dnn$name<-"2018-03-01"
dd<-rbind(dnr,dnn)

ggplot(dd, aes(time, value, fill = name)) + geom_bar(position = "dodge",stat="identity")+labs(title="What Happened in 2 Mar, 2018?",x="Hour",y="Traffic Freq")+theme_bw()+scale_fill_discrete(name="Date")
```

![ìºê¸€_ë¬´ìŠ¨ì¼](https://user-images.githubusercontent.com/54492747/79867325-28190a80-8419-11ea-829d-a004b01e6d93.JPG)

- 2ì¼ì˜ Trffic 911 í†µí™”ëŸ‰ì€ 1ì¼ë³´ë‹¤ í˜„ì €íˆ ë§ìŠµë‹ˆë‹¤.
- ì˜¤í›„ 3~6ì‹œì— ì¤‘ëŒ€í•œ Traffic ì‚¬ê³ ê°€ ìˆì—ˆë˜ ê²ƒìœ¼ë¡œ ë³´ì—¬ì§‘ë‹ˆë‹¤.

<br>

### ğŸš‘ 911 Call Trend by Month, Day, Hour

#### ğŸ“ Calls - Monthly

```{r}
#month$Month<-c(1:10,12)
#month<-month[c(11,1:10),]

plot_ly(month, x = ~Month, y = ~EMS, type = 'bar', name = 'EMS') %>%
  add_trace(y = ~Traffic, name = 'Traffic') %>% add_trace(y = ~Fire, name = 'Fire') %>% 
  layout(title="911 Calls -Monthly", yaxis = list(title = 'Count'), barmode = 'stack' ,xaxis=list(type = "category",  categoryorder = "array",
  categoryarray = c(1:12)))
```

![ìºê¸€_ì›”í†µí™”](https://user-images.githubusercontent.com/54492747/79867627-9958bd80-8419-11ea-8396-4e0c5044f3b2.JPG)

- 12ì›”ê³¼ 1~3ì›”ì´ ë‹¤ë¥¸ ë‹¬ì— ë¹„í•´ 911 í†µí™”ëŸ‰ì´ ë†’ìŠµë‹ˆë‹¤.
- ê·¸ì— ë°˜ë©´, 4~11ì›”ì˜ 911 í†µí™”ëŸ‰ì€ ìœ ì‚¬í•©ë‹ˆë‹¤.

<br>

#### ğŸ“ Calls - Daily

```{r}
plot_ly(day, x = ~Day, y = ~EMS, type = 'bar', name = 'EMS') %>%
  add_trace(y = ~Traffic, name = 'Traffic') %>% add_trace(y = ~Fire, name = 'Fire') %>% 
  layout(title="911 Calls -Daily", yaxis = list(title = 'Count'), barmode = 'stack')
```

![ìºê¸€_ì¼í†µí™”](https://user-images.githubusercontent.com/54492747/79867630-9a89ea80-8419-11ea-8a32-aead75236642.JPG)

- 911 í†µí™” ë¹ˆë„ëŠ” 2ì¼ê³¼ 15ì¼ì´ ì œì¼ ë†’ìœ¼ë©°, 27ì¼ë¶€í„° 31ì¼ê¹Œì§€ ë‚®ìŠµë‹ˆë‹¤.
- 31ì¼ 911 í†µí™” ë¹ˆë„ê°€ í˜„ì €íˆ ë‚®ì€ ì´ìœ ëŠ”, 31ì¼ë¡œ êµ¬ì„±ë˜ì§€ ì•Šì€ ë‹¬ì˜ ë°ì´í„°ê°€ ì ê¸° ë•Œë¬¸ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- 2ì¼ê³¼ 15ì¼ì˜ ê²½ìš° 2018ë…„ 3ì›” 2ì¼ê³¼ 11ì›” 15ì¼ì— Traffic 911 í†µí™”ê°€ ìƒë‹¹íˆ ë§ì´ ê±¸ë ¤ì™”ê¸° ë•Œë¬¸ì—, 2ì¼ê³¼ 15ì¼ì˜ 911 í†µí™” ë¹ˆë„ê°€ ë§¤ìš° ë†’ìŠµë‹ˆë‹¤.
- ì´ëŸ¬í•œ ìš”ì¸ì„ ê³ ë ¤í•  ë•Œ, ì¼ë³„ í†µí™” ë¹ˆë„ì˜ íŠ¸ë Œë“œëŠ” ë³´ì´ì§€ ì•ŠëŠ” ê²ƒ ê°™ìŠµë‹ˆë‹¤.

<br>

#### ğŸ“ Calls - Hourly

```{r}
plot_ly(hour, x = ~Hour, y = ~EMS, type = 'bar', name = 'EMS') %>%
  add_trace(y = ~Traffic, name = 'Traffic') %>% add_trace(y = ~Fire, name = 'Fire') %>% 
  layout(title="911 Calls - Hourly", yaxis = list(title = 'Count'), barmode = 'stack')
```

![ìºê¸€_ì‹œê°„í†µí™”](https://user-images.githubusercontent.com/54492747/79867635-9c53ae00-8419-11ea-8068-cf83db129fb7.JPG)

- 911 í†µí™” ë¹ˆë„ëŠ” ì˜¤ì „ 7ì‹œë¶€í„° ì˜¤í›„ 9ì‹œê¹Œì§€ í™•ì‹¤íˆ ë” ë†’ìŠµë‹ˆë‹¤.
- ì‚¬ëŒë“¤ì€ ë‚® ì‹œê°„ì— ì£¼ë¡œ í™œë™ì„ í•˜ê¸° ë•Œë¬¸ì— ì´ ê¸°ê°„ ë™ì•ˆ ì‚¬ê³ ê°€ ë” ìì£¼ ë°œìƒí•  ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤.
- ë˜í•œ 911 í†µí™” ë¹ˆë„ê°€ ì›”, ì¼ë³´ë‹¤ëŠ” ì‹œê°„ë³„ë¡œ ì°¨ì´ê°€ ìˆìŒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<br>

#### ğŸ“ Calls - Weekly

```{r}
date_calls<-unique(calls$Date)

thurs<-date_calls[seq(from=1,to=321,by=7)]
fris<-date_calls[seq(from=2,to=321,by=7)]
sats<-date_calls[seq(from=3,to=321,by=7)]
suns<-date_calls[seq(from=4,to=321,by=7)]
mons<-date_calls[seq(from=5,to=321,by=7)]
tues<-date_calls[seq(from=6,to=321,by=7)]
weds<-date_calls[seq(from=7,to=321,by=7)]

calls$Week[is.element(calls$Date,thurs)==TRUE]<-"Thursday"
calls$Week[is.element(calls$Date,fris)==TRUE]<-"Friday"
calls$Week[is.element(calls$Date,sats)==TRUE]<-"Saturday"
calls$Week[is.element(calls$Date,suns)==TRUE]<-"Sunday"
calls$Week[is.element(calls$Date,mons)==TRUE]<-"Monday"
calls$Week[is.element(calls$Date,tues)==TRUE]<-"Tuesday"
calls$Week[is.element(calls$Date,weds)==TRUE]<-"Wednesday"
calls$Week<-as.factor(calls$Week)
levels(calls$Week)<-c("Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday")
str(calls$Week)

week <- as.data.frame(calls %>% select(-timeStamp) %>% group_by(Week, Types) %>% summarise(N=n()) %>% spread(Types, N))

plot_ly(week, x = ~Week, y = ~EMS, type = 'bar', name = 'EMS') %>%
  add_trace(y = ~Traffic, name = 'Traffic') %>% add_trace(y = ~Fire, name = 'Fire') %>% 
  layout(title="911 Calls -Weekly", yaxis = list(title = 'Count'), barmode = 'stack')
```
![ìºê¸€_ì¼ì£¼ì¼í†µí™”](https://user-images.githubusercontent.com/54492747/79867720-c0af8a80-8419-11ea-885d-e3ab33d33c36.JPG)

- ì£¼ë§ì´ í‰ì¼ë³´ë‹¤ 911 í†µí™” ë¹ˆë„ê°€ ë‚®ì„ ê²ƒìœ¼ë¡œ ì˜ˆìƒí–ˆëŠ”ë°, ì˜¤íˆë ¤ ìˆ˜ìš”ì¼ì´ í›¨ì”¬ ë‚®ì•„ì„œ ì¡°ê¸ˆ ë†€ëìŠµë‹ˆë‹¤.
- ê·¸ì™¸ì—ë„ ì‚¬ê³  ìœ í˜•ë³„ë¡œë„ í° ì°¨ì´ë¥¼ ë³´ì´ê³  ìˆì§€ ì•ŠìŠµë‹ˆë‹¤.í‰ì¼ ë™ì•ˆ ì´ 911 í†µí™” ë¹ˆë„ì™€ ìœ í˜• ë¹„ìœ¨ì€ ëª¨ë‘ ë¹„ìŠ·í•©ë‹ˆë‹¤.
- ìˆ˜ìš”ì¼ì— Traffic í†µí™”ëŸ‰ì´ ë‹¤ë¥¸ ìš”ì¼ë³´ë‹¤ ë‚®ì€ ê²ƒìœ¼ë¡œ ë³´ì—¬ì§‘ë‹ˆë‹¤.

<br>

### ğŸš‘ Summarized Result, by Heat Map

íˆíŠ¸ë§µì€ ë°ì´í„° ê°’ì´ ìƒ‰ìœ¼ë¡œ í‘œí˜„ë˜ê²Œë” 3ì°¨ì›ì ìœ¼ë¡œ í‘œí˜„í•œ ê·¸ë˜í”„ì…ë‹ˆë‹¤. ì›”ë³„, ì¼ë³„, ì‹œê°„ë³„ë¡œ 911 í†µí™”ì˜ íˆíŠ¸ë§µì„ ë³´ê² ìŠµë‹ˆë‹¤. ì‚¬ê°í˜• ìƒ‰ìƒì´ ë…¸ë€ìƒ‰ìœ¼ë¡œ ê°€ê¹Œì›Œì§ˆìˆ˜ë¡ 911 í†µí™” ìˆ˜ëŠ” ë” ì»¤ì§‘ë‹ˆë‹¤.

#### ğŸ“ 911 Calls by "Day and Hour" & "Month and Hour"

```{r}
day_hour <- as.data.frame(calls[, c("Day", "Hour")] %>% group_by(Day, Hour) %>% summarise(N = n()))

ggplotly(ggplot(day_hour, aes(Day, Hour, fill = N)) + geom_tile(color = "white", size = 0.1) + scale_fill_viridis(name="Number of Calls") + coord_equal() + labs(title="911 Calls by Day and Hour"))
```
```{r}
month_hour <- as.data.frame(calls[, c("Month", "Hour")] %>% group_by(Month, Hour) %>% summarise(N = n()))
levels(month_hour$Month) <- c("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov","Dec")

ggplotly(ggplot(month_hour, aes(Month, Hour, fill = N)) + geom_tile(color = "white") + scale_fill_viridis(name="Number of Calls") + coord_equal() + labs(title="911 Calls by Month and Hour"))
```
- ìœ„ì˜ ë‘ íˆíŠ¸ë§µ ê·¸ë˜í”„ë¥¼ ë³´ë©´, ëŒ€ë¶€ë¶„ì˜ ë…¸ë€ìƒ‰ ì‚¬ê°í˜•ì´ ê·¸ë˜í”„ ì¤‘ê°„ì— ê°€ë¡œë¡œ ì§‘ì¤‘ë˜ì–´ ìˆê¸° ë•Œë¬¸ì— ëŒ€ë¶€ë¶„ì˜ í†µí™”ê°€ ë‚® ì‹œê°„ì´ë¼ê³  ê°€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<br>

#### ğŸ“ 911 Calls by Day and Month
- 2ì›”, 4ì›”, 6ì›”, 9ì›”ì€ 31ì¼ë¡œ êµ¬ì„±ë˜ì–´ ìˆì§€ ì•Šê¸° ë•Œë¬¸ì— ë¹ˆì¹¸ì´ ìˆìŠµë‹ˆë‹¤.

```{r}
day_hour <- as.data.frame(calls[, c("Day", "Month")] %>% group_by(Day, Month) %>% summarise(N = n()))
levels(day_hour$Month) <- c("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec")

ggplotly(ggplot(day_hour, aes(Day,Month, fill = N)) + geom_tile(color = "white", size = 0.1) + scale_fill_viridis(name="Number of Calls") + coord_equal() + labs(title="911 Calls by Day and Hour"))
```

- ì¼ë³„ê³¼ ì›”ë³„ íˆíŠ¸ë§µ ê·¸ë˜í”„ì—ì„œëŠ” íŒ¨í„´ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
- ì¼ë³„ê³¼ ì›”ë³„ë³´ë‹¤ëŠ” ì£¼ë¡œ ì‹œê°„ì— ë”°ë¼ 911 í†µí™”ê°€ ì´ë¤„ì§€ëŠ” ê²ƒìœ¼ë¡œ ë³´ì…ë‹ˆë‹¤.

<br>

## 2.3 911 Calls in Montgomery County, by Townships

### ğŸš‘ Mosaic Plot by Types of 911 Calls 

```{r}
town_type <- as.data.frame(calls %>% select(Types, twp))
freq.town <- as.data.frame(table(calls$twp)) %>% arrange(desc(Freq))
top<-as.character(freq.town[1:10,1])
top_town<-town_type[is.element(town_type$twp,top),]
topab<-c("LM", "ABING", "NORRIS", "UM", "CHEL", "POTT", "UML", "LP", "PLY", "HOR")
top_town$twp <- as.character(top_town$twp)
top_town$twp<-factor(top_town$twp,levels=top)
levels(top_town$twp)<-topab
table_1 <- with(top_town, table(twp,Types))
mosaicplot(table_1, main="Mosaic Plot by Types and Top 10 townships",color=c('light green','tomato','light blue'),cex.axis =1,off=3,border="white",xlab="Township",ylab="Type")
```

![ìºê¸€_ëª¨ììµ](https://user-images.githubusercontent.com/54492747/79868413-d1accb80-841a-11ea-8da5-8c2067ff4ab7.JPG)

- ì•½ì–´ì— ëŒ€í•œ ê°„ë‹¨í•œ ì„¤ëª…ì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤. :
    + `LM` : LOWER MERION
    + `ABING` : ABINGTON
    + `NORRIS` : NORRISTOWN
    + `UM` : UPPER MERION
    + `CHEL` : CHELTENHAM
    + `POTT` : POTTSTOWN
    + `UML` : UPPER MORELAND
    + `LP` : LOWER PROVIDENCE
    + `PLY` : PLYMOUTH
    + `HOR` : HORSHAM

- ìœ„ì˜ ê·¸ë˜í”„ëŠ” ìƒìœ„ 10ê°œ êµ°êµ¬(township)ì´ ë³´ìœ í•œ 911 í†µí™” ìœ í˜•ì˜ ë¹„ìœ¨ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.
- ì¼ë°˜ì ìœ¼ë¡œ EMS í†µí™” ë¹ˆë„ê°€ ê°€ì¥ ë†’ê³  Traffic ë° Fireê°€ ë’¤ë¥¼ ì‡ìŠµë‹ˆë‹¤.
- í•˜ì§€ë§Œ ë¹„ìœ¨ì€ ê° êµ°êµ¬(township)ë§ˆë‹¤ ì°¨ì´ê°€ ìˆìŠµë‹ˆë‹¤.
- County ì˜íšŒëŠ” ì´ê²ƒì— ë§ê²Œ ê° êµ°êµ¬(township)ì— ë¹„ë¡€í•˜ì—¬ êµ¬ì¡° ëŒ€ì›ë“¤ì„ í• ë‹¹í•´ì•¼ í•©ë‹ˆë‹¤.

<br>

### ğŸš‘ How does the Top 5 subtypes vary among top 10 township?

#### ğŸ“ Top 5 Subtypes

```{r}
ems.subtype <- as.data.frame(table(calls[calls$Types=="EMS",]$Subtypes)) %>% arrange(desc(Freq))
ems.subtype$Var1<-paste(ems.subtype$Var1,"E",sep=" - ")

fire.subtype <- as.data.frame(table(calls[calls$Types=="Fire",]$Subtypes)) %>% arrange(desc(Freq))
fire.subtype$Var1<-paste(fire.subtype$Var1,"F",sep=" - ")

traffic.subtype <- as.data.frame(table(calls[calls$Types=="Traffic",]$Subtypes)) %>% arrange(desc(Freq))
traffic.subtype$Var1<-paste(traffic.subtype$Var1,"T")

freq.sub <- rbind(ems.subtype,fire.subtype,traffic.subtype)%>%arrange(desc(Freq))

freq.sub %>% head(5) %>% ggplot(aes(reorder(Var1,Freq), Freq)) + geom_bar(stat = "identity", aes(fill=Var1)) + coord_flip() + theme_bw() + ggtitle("911 Calls") + xlab("Top 5 Subtypes") + ylab("Frequency") + theme(legend.position = "none") + geom_text(aes(label=Freq, y= Freq + 2*sign(Freq),size=2)) 
```

![ìºê¸€_íƒ‘5](https://user-images.githubusercontent.com/54492747/79868538-028d0080-841b-11ea-8f6f-b61a3bc00f65.JPG)

- ì´ë“¤ì€ ê°€ì¥ í° ë¹ˆë„ë¥¼ ê°€ì§„ ìƒìœ„ 5ê°€ì§€ í•˜ìœ„ ìœ í˜•ì…ë‹ˆë‹¤.
- ì°¨ëŸ‰ê³¼ ê´€ë ¨ëœ í•˜ìœ„ ìœ í˜•ì´ 1, 2ìœ„ë¥¼ ì°¨ì§€í•©ë‹ˆë‹¤.
- EMSì˜ í•˜ìœ„ ìœ í˜•ì€ Trafficì˜ í•˜ìœ„ ìœ í˜•ë³´ë‹¤ í›¨ì”¬ ë‚®ìŠµë‹ˆë‹¤.

<br>

#### ğŸ“ Mosaic plot by Subtypes of 911 Calls

```{r}
ems.sub <- as.data.frame(calls[calls$Types=="EMS",] %>% select(Subtypes, twp))
ems.sub$Subtypes <- paste(ems.sub$Subtypes,"E",sep=" - ")
fire.sub <- as.data.frame(calls[calls$Types=="Fire",] %>% select(Subtypes, twp))
fire.sub$Subtypes <- paste(fire.sub$Subtypes,"F",sep=" - ")
traffic.sub <- as.data.frame(calls[calls$Types=="Traffic",] %>% select(Subtypes, twp))
traffic.sub$Subtypes <- paste(traffic.sub$Subtypes,"T")

mosaic.sub <- rbind(ems.sub, fire.sub, traffic.sub)
top <- as.character(freq.town[1:10,1]) # Top 10 township
topp <- as.character(freq.sub[1:5,1]) # Top 5 Subtypes
mosaic.sub <- mosaic.sub[is.element(mosaic.sub$twp,top),]
mosaic.sub <- mosaic.sub[is.element(mosaic.sub$Subtypes,topp),]
topabc <- c("VA-T","DV-T","FA-F","RE-E","CE-E")
topab <- c("LM", "ABING", "NORRIS", "UM", "CHEL", "POTT", "UML", "LP", "PLY", "HOR")
mosaic.sub$twp <- as.character(mosaic.sub$twp)
mosaic.sub$Subtypes <- as.character(mosaic.sub$Subtypes)
mosaic.sub$twp <- factor(mosaic.sub$twp,levels=top)
mosaic.sub$Subtypes <- factor(mosaic.sub$Subtypes,levels=topp)
levels(mosaic.sub$twp)<-topab
levels(mosaic.sub$Subtypes)<-topabc
table_2 <- with(mosaic.sub, table(twp,Subtypes))
mosaicplot(table_2, las=1,main="Mosaic Plot by Top 5 Subtypes and Top 10 townships", cex.axis =1,off=3,border="white",xlab="Township",ylab="Subtype",color=c('orange','sky blue','green','steelblue4','tomato1'))
```

![ìºê¸€_ëª¨ììµ_ì„¸ë¶€](https://user-images.githubusercontent.com/54492747/79868620-1df80b80-841b-11ea-9a11-8557237d9dca.JPG)

- ì•½ì–´ì— ëŒ€í•œ ê°„ë‹¨í•œ ì„¤ëª…ì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤. :
    + `VA-T` : VEHICLE ACCIDENT (Traffic)
    + `DV-T` : DISABLED VEHICLE (Traffic)
    + `FA-F` : FIRE ALARM (Fire)
    + `RE-E` : RESPIRATORY EMERGENCY (EMS)
    + `CE-E` : CARDIAC EMERGENCY (EMS)

- ê·¸ë˜í”„ë¥¼ ë³¼ ë•Œ Trafficì— ëŒ€í•œ 911 í†µí™” ë¹ˆë„ê°€ ê°€ì¥ ë†’ìŠµë‹ˆë‹¤.
- POTTSTOWNê³¼ LOWER PROVIDENCEì€ Trfficì— ëŒ€í•œ 911 í†µí™” ë¹„ìœ¨ì´ ìƒëŒ€ì ìœ¼ë¡œ ë‚®ì•˜ìŠµë‹ˆë‹¤.
- POTTSTOWNì€ Countyì˜ ê°€ì¥ìë¦¬ì— ìœ„ì¹˜í•´ ìˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ë‚®ì€ ë¹ˆë„ì˜ êµí†µì‚¬ê³ ê°€ ì¼ì–´ë‚œ ê²ƒìœ¼ë¡œ ë³´ì…ë‹ˆë‹¤.

<br>

### ğŸš‘ Summarized Result, by Heat Map for Each Townships

#### ğŸ“911 Calls by "Month and Hour" & "Day and Hour" (without transformation)

```{r}
monthhour.sub <- as.data.frame(calls[, c("Month", "Hour","twp")] %>% group_by(Month, Hour,twp) %>% summarise(N = n()))
top<-as.character(freq.town[1:10,1])
monthhour.sub <- monthhour.sub[is.element(monthhour.sub$twp,top),]
levels(monthhour.sub$Month) <- c("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov","Dec")

ggplot(monthhour.sub, aes(Month, Hour, fill = N)) + geom_tile(color = "white", size = 0.1) + scale_fill_viridis(name="Number of Calls") + coord_equal() + labs(title="911 Calls by Month and Hour") + facet_wrap(~twp, ncol=5) + theme(legend.position="bottom") 
```

```{r}
dayhour.sub <- as.data.frame(calls[, c("Day", "Hour","twp")] %>% group_by(Day, Hour,twp) %>% summarise(N = n()))
top<-as.character(freq.town[1:10,1])
dayhour.sub <- dayhour.sub[is.element(dayhour.sub$twp,top),]

ggplot(dayhour.sub, aes(Day, Hour, fill = N)) + geom_tile(color = "white", size = 0.1) + scale_fill_viridis(name="Number of Calls") + coord_equal() + labs(title="911 Calls by Day and Hour") + facet_wrap(~twp, ncol=5) + theme(legend.position="bottom")
```

![ìºê¸€_íˆíŠ¸ë§µ_1_1](https://user-images.githubusercontent.com/54492747/79868884-8f37be80-841b-11ea-9477-a9cc85e95bfb.JPG)
![ìºê¸€_íˆíŠ¸ë§µ_1_2](https://user-images.githubusercontent.com/54492747/79868888-9068eb80-841b-11ea-8c2b-a5bf4d35d7cc.JPG)

- Lower Merionì—ì„œëŠ” ì´ 911 í†µí™”ì˜ ë¹ˆë„ê°€ ìƒëŒ€ì ìœ¼ë¡œ ë†’ìŠµë‹ˆë‹¤. ê·¸ì— ë°˜ë©´ ë‹¤ë¥¸ êµ°êµ¬(township)ëŠ” ë¹ˆë„ê°€ ë‚®ê¸° ë•Œë¬¸ì— ì „ì²´ì ì¸ íŒ¨í„´ì„ ì•Œê¸° ì–´ë µìŠµë‹ˆë‹¤.

<br>

#### ğŸ“911 Calls by "Month and Hour" & "Day and Hour" (with square-rooted frequency)**

```{r}
ggplot(monthhour.sub, aes(Month, Hour, fill = sqrt(N) )) + geom_tile(color = "white", size = 0.1) + scale_fill_viridis(name="Number of Calls") + coord_equal() + labs(title="911 Calls by Month and Hour") + facet_wrap(~twp, ncol=5) + theme(legend.position="bottom") 
```

```{r} 
ggplot(dayhour.sub, aes(Day, Hour, fill = sqrt(N))) + geom_tile(color = "white", size = 0.1) + scale_fill_viridis(name="Number of Calls") + coord_equal() + labs(title="911 Calls by Day and Hour") + facet_wrap(~twp, ncol=5) + theme(legend.position="bottom")
```

![ìºê¸€_íˆíŠ¸ë§µ_2_1](https://user-images.githubusercontent.com/54492747/79868890-9068eb80-841b-11ea-9dd5-20eeec9843e5.JPG)
![ìºê¸€_íˆíŠ¸ë§µ_2_2](https://user-images.githubusercontent.com/54492747/79868895-91018200-841b-11ea-8819-453293f5f4c8.JPG)

- êµ°êµ¬(township) ê°„ 911 í†µí™” ë¹ˆë„ì˜ ì°¨ì´ë¥¼ ë”ìš± ë¹„êµí•˜ê¸° ì‰½ê²Œ ê° ë„ì‹œì˜ ë¹ˆë„ë¥¼ ì œê³±í•˜ì˜€ìŠµë‹ˆë‹¤.
- ê·¸ ì „ì— ë¹„í•´ ëª…ë°±í•œ íŒ¨í„´ì„ ë³¼ ìˆ˜ ìˆì—ˆìœ¼ë©°, êµ°êµ¬(township)ì— ìƒê´€ì—†ì´ ëª¨ë“  íˆíŠ¸ë§µì€ ì¤‘ì•™ì— ë…¸ë€ìƒ‰ìœ¼ë¡œ ë” ì§„í•˜ê²Œ í‘œì‹œë˜ì—ˆìŠµë‹ˆë‹¤.
- ê° êµ°êµ¬(township)ë³„ íˆíŠ¸ë§µì„ ë³´ë©´ 911 í†µí™” ë¹ˆë„ëŠ” ëŒ€ë¶€ë¶„ ì‹œê°„ì— ë”°ë¼ ì°¨ì´ê°€ ë‚©ë‹ˆë‹¤.

<br>

## 2.4 Forecasting the number of accidents in the future

ì´ì œ ì•ìœ¼ë¡œ ë°œìƒí•  ìˆ˜ ìˆëŠ” ì‚¬ê³ ì˜ ìˆ˜ë¥¼ ì˜ˆì¸¡í•´ ë³´ê² ìŠµë‹ˆë‹¤. ì—¬ê¸°ì—ì„œëŠ” ì‹œê³„ì—´ ë¶„ì„ì´ ì‚¬ìš©ë˜ì—ˆìŠµë‹ˆë‹¤. 

1) ë¨¼ì €, **ìê¸°ìƒê´€í•¨ìˆ˜(autocorrelation function)ì™€ í¸ìê¸°ìƒê´€í•¨ìˆ˜(partial autocorrelation function)**ë¥¼ ê³„ì‚°í•˜ì—¬, ë°ì´í„°ê°€ ì •ìƒì„±(stationary)ì„ ê°–ëŠ”ì§€ ì—¬ë¶€ë¥¼ ê°„ë‹¨í•˜ê²Œ í™•ì¸í–ˆìŠµë‹ˆë‹¤. 

2) ë‘˜ì§¸, `niffs`í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ì°¨ë¶„(differences)ì´ í•„ìš”í•œì§€ í™•ì¸í–ˆìŠµë‹ˆë‹¤.

3) ì…‹ì§¸, ê·€ë¬´ê°€ì„¤ì— ëŒ€í•´ Dickey-Fuller í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰í–ˆìœ¼ë©° ë°ì´í„°ê°€ ë¹„ì •ìƒì„±(non-stationary)ì„ ê°–ëŠ” ê²ƒì„ í™•ì¸í–ˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë¯€ë¡œ ê·€ë¬´ê°€ì„¤ì„ ê¸°ê°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

4) ë§ˆì§€ë§‰ìœ¼ë¡œ, AIC, AICc, BIC ê°’ìœ¼ë¡œ ìµœê³ ì˜ ARIMA ëª¨ë¸ì„ ì°¾ìœ¼ë ¤ê³  í–ˆìŠµë‹ˆë‹¤.

```{r}
date <- as.data.frame(calls %>% select(-timeStamp) %>% group_by(Date, Types) %>% summarise(N=n()) %>% spread(Types, N))

ems_ts <- ts(date[,2],frequency=7)
fire_ts <- ts(date[,3],frequency=7) 
traffic_ts <- ts(date[,4],frequency=7)
# create time-series objects

acf(ems_ts) # lag.max: maximum lag at which to calculate the acf
pacf(ems_ts)
acf(fire_ts) 
pacf(fire_ts)
acf(traffic_ts) 
pacf(traffic_ts)
# Computes Autocorrelation function & Partial autocorrelation function

ndiffs(ems_ts)
ndiffs(fire_ts)
ndiffs(traffic_ts)
# Estimate the number of differences required to make a given time series stationary

adf.test(ems_ts)
adf.test(fire_ts)
adf.test(traffic_ts)
# Computes the Dickey-Fuller test for the null-hypothesis that the data are non-stationary

fitted_ems <- auto.arima(ems_ts)
fitted_fire <- auto.arima(fire_ts)
fitted_traffic <- auto.arima(traffic_ts)
# Finds best ARIMA model according to either AIC, AICc or BIC value
```

```{r}
forecasted_ems <- forecast(fitted_ems,15)
forecasted_fire <- forecast(fitted_fire,15)
forecasted_traffic <- forecast(fitted_traffic,15)
# forecasting from time series

op <- par(mfrow = c(3,1),
          mar = c(2,4,1,2)+.1, pty='m')
plot(forecasted_ems, main="Forecast: Emergency Medical Service", xlab="Time",xaxt = "n")
axis(1, at=1:51, labels=seq(1,357,by=7))
plot(forecasted_fire, main="Forecast: Fire", xlab="Time",xaxt="n")
axis(1, at=1:51, labels=seq(1,357,by=7))
plot(forecasted_traffic, main="Forecast: Traffic", xlab="Time",xaxt="n")
axis(1, at=1:51, labels=seq(1,357,by=7))
par(op)
```

```{r}
Date <- c("2020-04-09", "2020-04-10", "2020-04-11", "2020-04-12", "2020-04-13", "2020-04-14", "2020-04-15")
EMS <- round(as.data.frame(forecast(fitted_ems,7))[,1],2)
Fire <- round(as.data.frame(forecast(fitted_fire,7))[,1],2)
Traffic <- round(as.data.frame(forecast(fitted_traffic,7))[,1],2)
forecast_day <- data.frame(Date, EMS, Fire, Traffic)

knitr::kable(forecast_day)
```

![ìºê¸€_ì‹œê³„ì—´ì˜ˆì¸¡](https://user-images.githubusercontent.com/54492747/79868905-952d9f80-841b-11ea-86d6-c5c1afed2d53.JPG)
![ìºê¸€_ì‹œê³„ì—´ì˜ˆì¸¡ê°’](https://user-images.githubusercontent.com/54492747/79868911-95c63600-841b-11ea-88bf-d358f7723c33.JPG)

- 7ì¼(1ì£¼) ë™ì•ˆì˜ 3ê°€ì§€ ìœ í˜•ì— ëŒ€í•œ 911 í†µí™”ì˜ ì˜ˆìƒ íšŸìˆ˜ì…ë‹ˆë‹¤.
- ì†”ì§íˆ ì˜ˆì¸¡ì˜ ê²°ê³¼ëŠ” ì´ˆê¸° ëª©ì ì—ì„œ ë§ì´ ë¹—ë‚˜ê°€ê³  ìˆìŠµë‹ˆë‹¤. ì˜ˆì¸¡ëœ ê²°ê³¼ë¥¼ ì‚¬ìš©í•˜ì—¬ êµ¬ì¡°ëŒ€ì›ë“¤ì„ ì ì ˆíˆ ë°°ì¹˜í•˜ê³  ì‹¶ì—ˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ì´ ì˜ˆì¸¡ë§Œìœ¼ë¡œëŠ” ì¶©ë¶„í•˜ì§€ ì•Šë‹¤ê³  ìƒê°í•©ë‹ˆë‹¤.
- ë¶„ì„í•œ ë°ì´í„°ëŠ” ë§¤ì¼ ìˆ˜ì§‘ë˜ëŠ” ì‹œê³„ì—´ ë°ì´í„°ì´ë©°, ë˜í•œ ì´ê²ƒì€ ì‚¬ê³ ì— ëŒ€í•œ ë°ì´í„°ì…ë‹ˆë‹¤. ë¹„ë¡ ë¹„ì •ìƒì„±(non-stationary) ì¡°ê±´ì„ ë§Œì¡±í–ˆì§€ë§Œ íŒ¨í„´ì´ ì—†ì—ˆê³  ë°ì´í„°ì— ì„¤ëª…í•  ìˆ˜ ì—†ëŠ” ë³€ë™ì´ ì¡´ì¬í•˜ì˜€ìŠµë‹ˆë‹¤.
- ë”°ë¼ì„œ ìœ„ì—ì„œ ì§„í–‰ëœ ì‹œê³„ì—´ ë¶„ì„ì€ ì´ ë°ì´í„°ë¥¼ ë¶„ì„í•˜ëŠ” ë° í¬ê²Œ ì˜ë¯¸ê°€ ì—†ë‹¤ê³  ìƒê°í•©ë‹ˆë‹¤.
- Anomaly Detection ë“± ë‹¤ë¥¸ ë°©ë²•ì„ ì¨ì„œ ì˜ˆì¸¡ì„ í•œë²ˆ í•´ë³´ê³  ì‹¶ìŠµë‹ˆë‹¤. (í¬ë§ì‚¬í•­..)

<br>

---

# 3. Conclusion

- ì´ ë°ì´í„°ë§Œì„ ì‚¬ìš©í•˜ì—¬ 911 í†µí™” ë¹ˆë„ë¥¼ ì˜ˆì¸¡í•˜ëŠ” ê²ƒì€ ë¶ˆê°€ëŠ¥í•˜ì˜€ìŠµë‹ˆë‹¤.
    * ì‚¬ê³ ë¥¼ ì˜ˆì¸¡í•˜ê¸° ìœ„í•´ ë² ì´ì§€ì•ˆ ë¶„ì„ ë“± ë‹¤ë¥¸ ë¶„ì„ ë°©ë²•ë¡ ì„ ì´ìš©í•˜ëŠ” ê²ƒë„ ì¢‹ì„ ê²ƒ ê°™ë‹¤ê³  ìƒê°í•©ë‹ˆë‹¤.
    * ë² ì´ì§€ì•ˆ ë¶„ì„ì„ ìœ„í•´ ê° ì‚¬ê³  ìœ í˜•(ìœ ë™ ì¸êµ¬, ë‚ ì”¨ ë“±)ì˜ ë°œìƒê³¼ ë°€ì ‘í•˜ê²Œ ê´€ë ¨ëœ ë³€ìˆ˜ë¥¼ ë” ë§ì´ ìˆ˜ì§‘í•´ì•¼ í•˜ë©°, ì´ ë°ì´í„°ë§Œìœ¼ë¡œëŠ” ì¶©ë¶„í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

- ì´ ë°ì´í„°ë¥¼ ë¶„ì„í•˜ëŠ” ë™ì•ˆ, êµ¬ì¡°ëŒ€ì›ë“¤ì˜ ì‚¬íšŒì— ëŒ€í•œ í—Œì‹ ì— ë‹¤ì‹œ í•œ ë²ˆ ìƒê°í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. ëŒ€ë¶€ë¶„ì˜ ì‘ì—…ì€ ì„±ìˆ˜ê¸°ì™€ ë¹„ìˆ˜ê¸°ë¥¼ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ êµ¬ì¡°ëŒ€ì›ë“¤ì—ê²ŒëŠ” ë§¤ì¼ì´ ë°”ìœ ì‹œì¦Œì´ë©°, ì¼ë¶€ëŠ” ì•¼ê°„ ê·¼ë¬´ë¥¼ í•´ì•¼ í•˜ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.
    * ê·¸ë“¤ì„ ê¹Šì´ ì¡´ê²½í•´ì•¼ í•œë‹¤ê³  ë§í•˜ê³  ì‹¶ìœ¼ë©°, ìˆ˜ë§ì€ ë‚˜ë¼ì—ì„œ ê·¸ë“¤ì—ê²Œ ë†’ì€ ìˆ˜ì¤€ì˜ ë³µì§€ì™€ í˜œíƒì„ ì œê³µí–ˆìœ¼ë©´ ì¢‹ê² ë‹¤ëŠ” ìƒê°ì´ ê°€ë“í•©ë‹ˆë‹¤.
    * ëª¨ë“  ìœ í˜•ì˜ ì‚¬ê³ ëŠ” ì„œë¡œ ë°€ì ‘í•˜ê²Œ ê´€ë ¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ì‚¬ê³ ê°€ ë” ë§ì´ ë°œìƒí•¨ì„ ë°©ì§€í•˜ê¸° ìœ„í•´, ìš°ë¦¬ ëª¨ë‘ ì‚¬ê³ ê°€ ë°œìƒí•˜ì§€ ì•Šê²Œ ì£¼ì˜ë¥¼ ê¸°ìš¸ì—¬ì•¼ í•  ê²ƒ ê°™ìŠµë‹ˆë‹¤.

<br>

-------

### ğŸ”œ Next
2ì£¼ë¶€í„° 2ì£¼ì— 1ë²ˆì”© í•˜ë‚˜ì˜ ìºê¸€ ì£¼ì œë¥¼ ì •í•˜ì—¬ ìºê¸€ ë…¸íŠ¸ë¶ ì‘ì„±ì„ ëª©í‘œë¡œ í•˜ê³  ìˆìŠµë‹ˆë‹¤. (ìºê¸€ ì»¤ë„ í•„ì‚¬ ë˜ëŠ” ë¶„ì„) <br>
ìºê¸€ ë…¸íŠ¸ë¶ ì‘ì„±ì˜ ì‹œì‘ì„ ì—¬ëŠ” í•´ë‹¹ í¬ìŠ¤íŒ…ì€ í•™ë¶€ ë•Œ ìˆì—ˆë˜ íƒìƒ‰ì  ë¶„ì„ ìˆ˜ì—… ë•Œ ë°œí‘œí–ˆë˜ ë‚´ìš©ì´ë©°, ìµœê·¼ ì—…ë°ì´íŠ¸ëœ ë°ì´í„°ì— ë§ê²Œ ì¶”ê°€ì ìœ¼ë¡œ ë¶„ì„ì„ ë”í•˜ì—¬ ì‘ì„±í•´ë³´ì•˜ìŠµë‹ˆë‹¤. ì¡°ê¸ˆ ì°¨ë ¤ë†¨ë˜(?) ë°¥ìƒì´ë¼ ê·¸ëŸ°ì§€ ë‚˜ë¦„ ì´ê²ƒì €ê²ƒ ê·¸ë˜í”„ë¥¼ ê·¸ë¦¬ë©° ë°ì´í„°ë¥¼ ë³´ë ¤ê³  í•˜ì˜€ëŠ”ë°, ì´ë²ˆ ì£¼ì°¨ë¶€í„° ìƒˆë¡œìš´ ì£¼ì œë¡œ ì‹œì‘í•´ì•¼ í•˜ëŠ”ë° í€„ë¦¬í‹°ê°€ í™• ë–¨ì–´ì§ˆê¹Œë´ ê±±ì •ì´ ë˜ë„¤ìš”.ğŸ˜‚ ì‹œê°„ì´ ì—†ìœ¼ë©´ í•„ì‚¬ë¼ë„ í•˜ë ¤ê³  ë…¸ë ¥í•´ì•¼ê² ìŠµë‹ˆë‹¤.<br>
kaggle ë…¸íŠ¸ë¶ ì‘ì„±ë„ í•˜ê³  ì‘ì„±í•œ ë‚´ìš©ì„ ë°”íƒ•ìœ¼ë¡œ ë¸”ë¡œê·¸ì—ë„ ê±°ì˜ ë¹„ìŠ·í•˜ê²Œ í¬ìŠ¤íŒ…í•  ì˜ˆì •ì´ë‹ˆ, ë¶€ë”” ê¾¸ì¤€íˆ í¬ìŠ¤íŒ…í•  ìˆ˜ ìˆê¸¸ ë°”ëë‹ˆë‹¤. (ëª©í‘œëŠ” ì¼ë‹¨ 3ê°œì›”ë¡œ..!)
<br>

ê¸´ ê¸€ ì½ì–´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤. plotlyì˜ ê²½ìš° ì¶”ê°€ì ìœ¼ë¡œ githubì— settingì„ ë”í•´ì•¼í•˜ëŠ”ë° ì¡°ê¸ˆ ë•í›„ ê°™ì§€ë§Œ ì˜¤ëŠ˜ í•˜ë£¨ë„ ì¥ìˆ˜ì™€ ë²ˆì˜í•˜ì‹œê¸¸ ë°”ëë‹ˆë‹¤(Live Long and Prosper) ğŸ––
